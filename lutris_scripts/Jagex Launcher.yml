name: Jagex Launcher
game_slug: jagex-launcher
version: Installer
slug: jagex-launcher-installer
runner: wine

script:
  files:
    - jagexlauncher: https://cdn.jagex.com/Jagex%20Launcher%20Installer.exe
    - runelite: https://github.com/runelite/launcher/releases/download/2.6.4/RuneLite.AppImage

  game:
    exe: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/JagexLauncher.exe
  wine:
    overrides:
      jscript.dll: native
  installer:
    - task:
        description: Creating Wine prefix
        name: create_prefix
        prefix: $GAMEDIR
    - task:
        description: You must leave the installation path default. Advance through the dialogue and wait about one minute after pressing 'install'. The installer freezes, but still works in the background. Force quit this process using something like xkill on the jagex installer window to continue the lutris installer. If you don't have xkill, you can run "ps aux | grep 'cache/lutris/installer/jagex-launcher/jagexlauncher/' | grep -v grep | awk '{print $2}' | xargs kill"
        executable: $GAMEDIR/drive_c/windows/explorer.exe
        args: jagexlauncher
        include_processes: explorer.exe
        name: wineexec
        prefix: $GAMEDIR
        overrides:
          jscript.dll: native
    - task:
        name: winekill
        prefix: $GAMEDIR
    - merge:
        src: runelite
        dst: $GAMEDIR/drive_c/RuneLite
    - chmodx: runelite
    - write_file:
        file: $GAMEDIR/drive_c/RuneLite/runelite.sh
        content: |
          #!/bin/sh
          cd "$GAMEDIR/drive_c/RuneLite"
          ./RuneLite.AppImage --appimage-extract-and-run
    - chmodx: $GAMEDIR/drive_c/RuneLite/runelite.sh
    - execute:
        command: ln -s $GAMEDIR/drive_c/RuneLite/runelite.sh $GAMEDIR/drive_c/RuneLite/RuneLite.exe
    - write_file:
        file: $GAMEDIR/steamdeck-config.properties
        content: |
          runelite.automaticResizeType=KEEP_WINDOW_SIZE
          runelite.blockExtraMouseButtons=true
          runelite.clientBounds=0\:0\:1288\:807
          runelite.clientMaximized=true
          runelite.containInScreen2=NEVER
          runelite.dragHotkey=0\:512
          runelite.entityhiderplugin=false
          runelite.flashNotification=DISABLED
          runelite.fontType=SMALL
          runelite.gameAlwaysOnTop=false
          runelite.gameSize=1002x776
          runelite.groundmarkerplugin=true
          runelite.hdplugin=true
          runelite.idlenotifierplugin=false
          runelite.infoBoxSize=35
          runelite.infoBoxTextOutline=false
          runelite.infoBoxVertical=false
          runelite.infoboxFontType=REGULAR
          runelite.interfaceFontType=REGULAR
          runelite.itemidentificationplugin=false
          runelite.lockWindowSize=true
          runelite.menuentryswapperplugin=true
          runelite.metronomeplugin=false
          runelite.miningplugin=true
          runelite.motherlodeplugin=true
          runelite.notificationFlashColor=1191116800
          runelite.notificationFocused=true
          runelite.notificationGameMessage=false
          runelite.notificationRequestFocus=OFF
          runelite.notificationSound=CUSTOM
          runelite.notificationTimeout=2000
          runelite.notificationTray=true
          runelite.overlayBackgroundColor=-1673118414
          runelite.panelToggleKey=123\:128
          runelite.partyplugin2=true
          runelite.pcrewardsplugin=false
          runelite.pickpockethelperplugin=false
          runelite.rememberScreenBounds=true
          runelite.sidebarToggleKey=122\:128
          runelite.slayerplugin=true
          runelite.statusbarsplugin=true
          runelite.tileindicatorsplugin=true
          runelite.tooltipFontType=SMALL
          runelite.tooltipPosition=UNDER_CURSOR
          runelite.trayIcon=true
          runelite.uiEnableCustomChrome=true
          runelite.uiWindowOpacity=100
          runelite.useWikiItemPrices=true
          runelite.usernameInTitle=true
          runelite.warningOnExit=LOGGED_IN
          runelite.wintertodtnotificationsplugin=false
          runelite.xpglobesplugin=true
    - write_file:
        file: $GAMEDIR/drive_c/RuneScape/runescape3.sh
        content: |
          #!/bin/sh
          flatpak run --env=PULSE_LATENCY_MSEC=200 --env='vblank_mode=0' --env='MESA_GL_VERSION_OVERRIDE=4.5FC' com.jagex.RuneScape
    - chmodx: $GAMEDIR/drive_c/RuneScape/runescape3.sh
    - execute:
        command: ln -s $GAMEDIR/drive_c/RuneScape/runescape3.sh $GAMEDIR/drive_c/RuneScape/RuneScape.exe
    - task:
        name: set_regedit
        path: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\RuneLite Launcher_is1
        key: InstallLocation
        value: C:\\RuneLite
    - task:
        name: set_regedit
        path: HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall\RuneScape Launcher_is1
        key: InstallLocation
        value: C:\\RuneScape