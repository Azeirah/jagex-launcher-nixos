name: Jagex Launcher
game_slug: jagex-launcher
version: Installer
slug: jagex-launcher-installer
runner: wine

script:
  files:
    - jagexlauncher: https://cdn.jagex.com/Jagex%20Launcher%20Installer.exe
    - runelite: https://github.com/runelite/launcher/releases/download/2.6.4/RuneLite.AppImage
    - runelite-launcher: https://raw.githubusercontent.com/TormStorm/jagex-launcher-linux/main/resources/runelite.sh
    - runescape-launcher: https://raw.githubusercontent.com/TormStorm/jagex-launcher-linux/main/resources/runescape.sh
    - steamdeck-config: https://raw.githubusercontent.com/TormStorm/jagex-launcher-linux/main/resources/steamdeck-config.properties

  game:
    exe: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/JagexLauncher.exe
  wine:
    overrides:
      jscript.dll: native
  installer:
    - task:
        description: Creating Wine prefix
        name: create_prefix
        prefix: $GAMEDIR
    - task:
        description: Leave the installation path as default and advance through the dialogue. After clicking install the installer will appear to freeze. This is expected, and the installer still works in the background. After waiting about one minute you can close the Jagex Launcher with the following command "ps aux | grep 'cache/lutris/installer/jagex-launcher/jagexlauncher/' | grep -v grep | awk '{print $2}' | xargs kill"
        executable: $GAMEDIR/drive_c/windows/explorer.exe
        args: jagexlauncher
        include_processes: explorer.exe
        name: wineexec
        prefix: $GAMEDIR
        overrides:
          jscript.dll: native
    - task:
        name: winekill
        prefix: $GAMEDIR
    - execute:
        command: mkdir "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/"
        description: Creating game directory
    - merge:
        src: runelite
        dst: "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite"
    - chmodx: runelite
    - merge:
        src: runelite-launcher
        dst: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite
    - chmodx: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite/runelite.sh
    - execute:
        command: ln -s "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite/runelite.sh" "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite/RuneLite.exe"
    - merge:
        src: steamdeck-config
        dst: $GAMEDIR
    - merge:
        src: runescape-launcher
        dst: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneScape
    - chmodx: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneScape/runescape.sh
    - execute:
        command: ln -s "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneScape/runescape.sh" "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneScape/RuneScape.exe"
    - task:
        name: set_regedit
        path: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\RuneLite Launcher_is1
        key: InstallLocation
        value: C:\\Program Files (x86)\\Jagex Launcher\\Games\\RuneLite
    - task:
        name: set_regedit
        path: HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall\RuneScape Launcher_is1
        key: InstallLocation
        value: C:\\Program Files (x86)\\Jagex Launcher\\Games\\RuneScape
